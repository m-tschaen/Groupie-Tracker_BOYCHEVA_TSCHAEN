<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <title>Carte des Concerts</title>
        <link rel="stylesheet" href="/static/css/style.css">
        <link rel="stylesheet" href="/static/css/locations.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    </head>
    <body>
        <input type="checkbox" id="theme" class="theme" style="display: none;">
        <div class="app-layout">
            <aside class="sidebar">
                <div class="sidebar-logo">
                    <img src="/static/img/light_logo.png" alt="Logo">
                </div>
                <nav class="sidebar-nav">
                    <a href="/tracker">Accueil</a>
                    <a href="/locations" class="active">Carte</a>
                </nav>
                <div class="line"></div>
                <div class="sidebar-section-title">Continents Top</div>
                <div class="sidebar-artists">
                    {{range .Continents}}
                        <div class="sidebar-artist">
                            <div class="sidebar-artist-info">
                                <h4>{{.Name}}</h4>
                                <p>{{.TotalConcerts}} concerts</p>
                            </div>
                        </div>
                    {{end}}
                </div>
            </aside>
            <main class="main-content-map">
                <div class="locations-header">
                    <h1>Carte des Concerts</h1>
                    <p>Découvrez tous les lieux de concerts à travers le monde</p>
                </div>
                <div class="map-view-box">
                    <div class="zoom-controls">
                        <button onclick="zoomIn()" class="zoom-btn" title="Zoom avant">+</button>
                        <button onclick="resetZoom()" class="zoom-btn" title="Réinitialiser">⊙</button>
                        <button onclick="zoomOut()" class="zoom-btn" title="Zoom arrière">−</button>
                    </div>  
                    <div id="map-container" style="position: relative; overflow: auto; max-height: 600px; cursor: grab;">
                        <img id="map-image" src="https://upload.wikimedia.org/wikipedia/commons/8/83/Equirectangular_projection_SW.jpg" alt="Carte du monde" style="width: 100%; height: auto; display: block; border-radius: 15px; opacity: 0.4; transition: transform 0.3s ease; transform-origin: top left; pointer-events: none;">
                        <svg id="map-svg" viewBox="0 0 1200 600" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; transition: transform 0.3s ease; transform-origin: top left;">
                            {{range $contIndex, $continent := .Continents}}
                                {{range $locIndex, $location := $continent.Locations}}
                                    <g class="location-marker" onclick="scrollToLocation('loc-{{$locIndex}}-{{$location.City}}')">
                                        <circle cx="{{$location.X}}" cy="{{$location.Y}}" r="10" fill="#d4af37" opacity="0.5" class="marker-pulse"/>
                                        <circle cx="{{$location.X}}" cy="{{$location.Y}}" r="6" fill="#ffd700" stroke="#fff" stroke-width="2" class="marker-dot"/>
                                        <text x="{{$location.X}}" y="{{$location.Y}}" dy="-18" class="marker-label" fill="#ffd700" font-size="14" text-anchor="middle" font-weight="700">
                                            {{$location.City}}
                                        </text>
                                        <text x="{{$location.X}}" y="{{$location.Y}}" dy="-35" class="marker-count" fill="#fff" font-size="12" text-anchor="middle" font-weight="600">
                                            {{$location.Count}} concert{{if gt $location.Count 1}}s{{end}}
                                        </text>
                                    </g>
                                {{end}}
                            {{end}}
                        </svg>
                    </div>
                </div>
                <div class="locations-organized">
                    <h2>Tous les Lieux de Concerts</h2>
                    {{range .Continents}}
                        <div class="continent-section">
                            <h3 class="continent-title" onclick="toggleContinent('{{.Name}}')">
                                {{.Name}}
                                    <span class="concert-count-badge">{{.TotalConcerts}} concerts</span>
                                    <span class="toggle-icon">▼</span>
                            </h3>
                            <div id="{{.Name}}" class="continent-content" style="display: none;">
                                {{range $index, $location := .Locations}}
                                    <div class="location-item" onclick="toggleDetails('loc-{{$index}}-{{$location.City}}')">
                                        <div class="location-header">
                                            <span class="location-name">{{$location.City}}, {{$location.Country}}</span>
                                            <span class="location-count">{{$location.Count}} concert{{if gt $location.Count 1}}s{{end}}</span>
                                        </div>
                                        <div id="loc-{{$index}}-{{$location.City}}" class="location-details">
                                            <p><strong>Artistes :</strong></p>
                                            <ul>
                                                {{range $artistIndex, $artistName := $location.Artists}}
                                                    <li><a href="/artist/{{index $location.ArtistIDs $artistIndex}}" class="artist-link">{{$artistName}}</a></li>
                                                {{end}}
                                            </ul>
                                        </div>
                                    </div>
                                {{end}}
                            </div>
                        </div>
                    {{end}}
                </div>
            </main>
        </div>
        <script src="/static/js/script.js" defer></script>
    </body>
</html>